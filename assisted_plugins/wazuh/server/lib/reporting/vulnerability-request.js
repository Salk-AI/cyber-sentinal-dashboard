"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.uniqueSeverityCount = exports.topPackagesWithCVE = exports.topPackages = exports.topCVECount = exports.topAgentCount = void 0;
var _baseQuery = require("./base-query");
/*
 * Wazuh app - Specific methods to fetch Wazuh vulnerability data from Elasticsearch
 * Copyright (C) 2015-2022 Wazuh, Inc.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * Find more information about this on the LICENSE file.
 */

/**
 * Returns top 3 agents for specific severity
 * @param {*} context Endpoint context
 * @param {Number} gte Timestamp (ms) from
 * @param {Number} lte Timestamp (ms) to
 * @param {String} severity Low, Medium, High, Critical
 * @param {String} filters E.g: cluster.name: wazuh AND rule.groups: vulnerability
 * @returns {Array<Number>}
 */
const topAgentCount = async (context, gte, lte, severity, filters, allowedAgentsFilter, pattern) => {
  try {
    const base = {};
    Object.assign(base, (0, _baseQuery.Base)(pattern, filters, gte, lte, allowedAgentsFilter));
    Object.assign(base.aggs, {
      '2': {
        terms: {
          field: 'agent.id',
          size: 3,
          order: {
            _count: 'desc'
          }
        }
      }
    });
    base.query.bool.must.push({
      match_phrase: {
        'data.vulnerability.severity': {
          query: severity
        }
      }
    });
    const response = await context.core.opensearch.client.asCurrentUser.search({
      index: pattern,
      body: base
    });
    const {
      buckets
    } = response.body.aggregations['2'];
    return buckets.map(item => item.key);
  } catch (error) {
    return Promise.reject(error);
  }
};

/**
 * Returns top 3 CVE
 * @param {Number} context Endpoint context
 * @param {Number} gte Timestamp (ms) from
 * @param {Number} lte Timestamp (ms) to
 * @param {String} filters E.g: cluster.name: wazuh AND rule.groups: vulnerability
 * @returns {Array<Number>}
 */
exports.topAgentCount = topAgentCount;
const topCVECount = async (context, gte, lte, filters, allowedAgentsFilter, pattern) => {
  try {
    const base = {};
    Object.assign(base, (0, _baseQuery.Base)(pattern, filters, gte, lte, allowedAgentsFilter));
    Object.assign(base.aggs, {
      '2': {
        terms: {
          field: 'data.vulnerability.cve',
          size: 3,
          order: {
            _count: 'desc'
          }
        }
      }
    });
    const response = await context.core.opensearch.client.asCurrentUser.search({
      index: pattern,
      body: base
    });
    const {
      buckets
    } = response.body.aggregations['2'];
    return buckets.map(item => item.key);
  } catch (error) {
    return Promise.reject(error);
  }
};

/**
 * Returns unique count of vulnerability alerts using specific severity.
 * @param {*} context Endpoint context
 * @param {Number} gte Timestamp (ms) from
 * @param {Number} lte Timestamp (ms) to
 * @param {String} severity Low, Medium, High, Critical
 * @param {String} filters E.g: cluster.name: wazuh AND rule.groups: vulnerability
 * @returns {Number}
 */
exports.topCVECount = topCVECount;
const uniqueSeverityCount = async (context, gte, lte, severity, filters, allowedAgentsFilter, pattern) => {
  try {
    const base = {};
    Object.assign(base, (0, _baseQuery.Base)(pattern, filters, gte, lte, allowedAgentsFilter));
    Object.assign(base.aggs, {
      '1': {
        cardinality: {
          field: 'agent.id'
        }
      }
    });
    base.query.bool.must.push({
      match_phrase: {
        'data.vulnerability.severity': {
          query: severity
        }
      }
    });
    const response = await context.core.opensearch.client.asCurrentUser.search({
      index: pattern,
      body: base
    });
    return response.body && response.body.aggregations && response.body.aggregations['1'] && response.body.aggregations['1'].value ? response.body.aggregations['1'].value : 0;
  } catch (error) {
    return Promise.reject(error);
  }
};
exports.uniqueSeverityCount = uniqueSeverityCount;
const topPackages = async (context, gte, lte, severity, filters, allowedAgentsFilter, pattern) => {
  try {
    const base = {};
    Object.assign(base, (0, _baseQuery.Base)(pattern, filters, gte, lte, allowedAgentsFilter));
    Object.assign(base.aggs, {
      '2': {
        terms: {
          field: 'data.vulnerability.package.name',
          size: 20,
          order: {
            _count: 'desc'
          }
        }
      }
    });
    base.query.bool.must.push({
      match_phrase: {
        'data.vulnerability.severity': {
          query: severity
        }
      }
    });
    const response = await context.core.opensearch.client.asCurrentUser.search({
      index: pattern,
      body: base
    });
    const {
      buckets
    } = response.body.aggregations['2'];
    return buckets.map(item => ({
      package: item.key,
      severity: severity
    }));
  } catch (error) {
    return Promise.reject(error);
  }
};
exports.topPackages = topPackages;
const topPackagesWithCVE = async (context, gte, lte, severity, filters, allowedAgentsFilter, pattern) => {
  try {
    const base = {};
    Object.assign(base, (0, _baseQuery.Base)(pattern, filters, gte, lte, allowedAgentsFilter));
    Object.assign(base.aggs, {
      '2': {
        terms: {
          field: 'data.vulnerability.package.name',
          size: 3,
          order: {
            _count: 'desc'
          }
        },
        aggs: {
          '3': {
            terms: {
              field: 'data.vulnerability.reference',
              size: 10,
              order: {
                _count: 'desc'
              }
            }
          }
        }
      }
    });
    base.query.bool.must.push({
      match_phrase: {
        'data.vulnerability.severity': {
          query: severity
        }
      }
    });
    const response = await context.core.opensearch.client.asCurrentUser.search({
      index: pattern,
      body: base
    });
    const {
      buckets
    } = response.body.aggregations['2'];
    return buckets.map(item => ({
      package: item.key,
      references: item['3'].buckets.map(ref => ref.key)
    }));
  } catch (error) {
    return Promise.reject(error);
  }
};
exports.topPackagesWithCVE = topPackagesWithCVE;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYmFzZVF1ZXJ5IiwicmVxdWlyZSIsInRvcEFnZW50Q291bnQiLCJjb250ZXh0IiwiZ3RlIiwibHRlIiwic2V2ZXJpdHkiLCJmaWx0ZXJzIiwiYWxsb3dlZEFnZW50c0ZpbHRlciIsInBhdHRlcm4iLCJiYXNlIiwiT2JqZWN0IiwiYXNzaWduIiwiQmFzZSIsImFnZ3MiLCJ0ZXJtcyIsImZpZWxkIiwic2l6ZSIsIm9yZGVyIiwiX2NvdW50IiwicXVlcnkiLCJib29sIiwibXVzdCIsInB1c2giLCJtYXRjaF9waHJhc2UiLCJyZXNwb25zZSIsImNvcmUiLCJvcGVuc2VhcmNoIiwiY2xpZW50IiwiYXNDdXJyZW50VXNlciIsInNlYXJjaCIsImluZGV4IiwiYm9keSIsImJ1Y2tldHMiLCJhZ2dyZWdhdGlvbnMiLCJtYXAiLCJpdGVtIiwia2V5IiwiZXJyb3IiLCJQcm9taXNlIiwicmVqZWN0IiwiZXhwb3J0cyIsInRvcENWRUNvdW50IiwidW5pcXVlU2V2ZXJpdHlDb3VudCIsImNhcmRpbmFsaXR5IiwidmFsdWUiLCJ0b3BQYWNrYWdlcyIsInBhY2thZ2UiLCJ0b3BQYWNrYWdlc1dpdGhDVkUiLCJyZWZlcmVuY2VzIiwicmVmIl0sInNvdXJjZXMiOlsidnVsbmVyYWJpbGl0eS1yZXF1ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBXYXp1aCBhcHAgLSBTcGVjaWZpYyBtZXRob2RzIHRvIGZldGNoIFdhenVoIHZ1bG5lcmFiaWxpdHkgZGF0YSBmcm9tIEVsYXN0aWNzZWFyY2hcbiAqIENvcHlyaWdodCAoQykgMjAxNS0yMDIyIFdhenVoLCBJbmMuXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBGaW5kIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyBvbiB0aGUgTElDRU5TRSBmaWxlLlxuICovXG5pbXBvcnQgeyBCYXNlIH0gZnJvbSAnLi9iYXNlLXF1ZXJ5JztcblxuLyoqXG4gKiBSZXR1cm5zIHRvcCAzIGFnZW50cyBmb3Igc3BlY2lmaWMgc2V2ZXJpdHlcbiAqIEBwYXJhbSB7Kn0gY29udGV4dCBFbmRwb2ludCBjb250ZXh0XG4gKiBAcGFyYW0ge051bWJlcn0gZ3RlIFRpbWVzdGFtcCAobXMpIGZyb21cbiAqIEBwYXJhbSB7TnVtYmVyfSBsdGUgVGltZXN0YW1wIChtcykgdG9cbiAqIEBwYXJhbSB7U3RyaW5nfSBzZXZlcml0eSBMb3csIE1lZGl1bSwgSGlnaCwgQ3JpdGljYWxcbiAqIEBwYXJhbSB7U3RyaW5nfSBmaWx0ZXJzIEUuZzogY2x1c3Rlci5uYW1lOiB3YXp1aCBBTkQgcnVsZS5ncm91cHM6IHZ1bG5lcmFiaWxpdHlcbiAqIEByZXR1cm5zIHtBcnJheTxOdW1iZXI+fVxuICovXG5leHBvcnQgY29uc3QgdG9wQWdlbnRDb3VudCA9IGFzeW5jIChcbiAgY29udGV4dCxcbiAgZ3RlLFxuICBsdGUsXG4gIHNldmVyaXR5LFxuICBmaWx0ZXJzLFxuICBhbGxvd2VkQWdlbnRzRmlsdGVyLFxuICBwYXR0ZXJuLFxuKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgYmFzZSA9IHt9O1xuXG4gICAgT2JqZWN0LmFzc2lnbihiYXNlLCBCYXNlKHBhdHRlcm4sIGZpbHRlcnMsIGd0ZSwgbHRlLCBhbGxvd2VkQWdlbnRzRmlsdGVyKSk7XG5cbiAgICBPYmplY3QuYXNzaWduKGJhc2UuYWdncywge1xuICAgICAgJzInOiB7XG4gICAgICAgIHRlcm1zOiB7XG4gICAgICAgICAgZmllbGQ6ICdhZ2VudC5pZCcsXG4gICAgICAgICAgc2l6ZTogMyxcbiAgICAgICAgICBvcmRlcjoge1xuICAgICAgICAgICAgX2NvdW50OiAnZGVzYycsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBiYXNlLnF1ZXJ5LmJvb2wubXVzdC5wdXNoKHtcbiAgICAgIG1hdGNoX3BocmFzZToge1xuICAgICAgICAnZGF0YS52dWxuZXJhYmlsaXR5LnNldmVyaXR5Jzoge1xuICAgICAgICAgIHF1ZXJ5OiBzZXZlcml0eSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNvbnRleHQuY29yZS5vcGVuc2VhcmNoLmNsaWVudC5hc0N1cnJlbnRVc2VyLnNlYXJjaCh7XG4gICAgICBpbmRleDogcGF0dGVybixcbiAgICAgIGJvZHk6IGJhc2UsXG4gICAgfSk7XG4gICAgY29uc3QgeyBidWNrZXRzIH0gPSByZXNwb25zZS5ib2R5LmFnZ3JlZ2F0aW9uc1snMiddO1xuXG4gICAgcmV0dXJuIGJ1Y2tldHMubWFwKGl0ZW0gPT4gaXRlbS5rZXkpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gIH1cbn07XG5cbi8qKlxuICogUmV0dXJucyB0b3AgMyBDVkVcbiAqIEBwYXJhbSB7TnVtYmVyfSBjb250ZXh0IEVuZHBvaW50IGNvbnRleHRcbiAqIEBwYXJhbSB7TnVtYmVyfSBndGUgVGltZXN0YW1wIChtcykgZnJvbVxuICogQHBhcmFtIHtOdW1iZXJ9IGx0ZSBUaW1lc3RhbXAgKG1zKSB0b1xuICogQHBhcmFtIHtTdHJpbmd9IGZpbHRlcnMgRS5nOiBjbHVzdGVyLm5hbWU6IHdhenVoIEFORCBydWxlLmdyb3VwczogdnVsbmVyYWJpbGl0eVxuICogQHJldHVybnMge0FycmF5PE51bWJlcj59XG4gKi9cbmV4cG9ydCBjb25zdCB0b3BDVkVDb3VudCA9IGFzeW5jIChcbiAgY29udGV4dCxcbiAgZ3RlLFxuICBsdGUsXG4gIGZpbHRlcnMsXG4gIGFsbG93ZWRBZ2VudHNGaWx0ZXIsXG4gIHBhdHRlcm4sXG4pID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBiYXNlID0ge307XG5cbiAgICBPYmplY3QuYXNzaWduKGJhc2UsIEJhc2UocGF0dGVybiwgZmlsdGVycywgZ3RlLCBsdGUsIGFsbG93ZWRBZ2VudHNGaWx0ZXIpKTtcblxuICAgIE9iamVjdC5hc3NpZ24oYmFzZS5hZ2dzLCB7XG4gICAgICAnMic6IHtcbiAgICAgICAgdGVybXM6IHtcbiAgICAgICAgICBmaWVsZDogJ2RhdGEudnVsbmVyYWJpbGl0eS5jdmUnLFxuICAgICAgICAgIHNpemU6IDMsXG4gICAgICAgICAgb3JkZXI6IHtcbiAgICAgICAgICAgIF9jb3VudDogJ2Rlc2MnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjb250ZXh0LmNvcmUub3BlbnNlYXJjaC5jbGllbnQuYXNDdXJyZW50VXNlci5zZWFyY2goe1xuICAgICAgaW5kZXg6IHBhdHRlcm4sXG4gICAgICBib2R5OiBiYXNlLFxuICAgIH0pO1xuICAgIGNvbnN0IHsgYnVja2V0cyB9ID0gcmVzcG9uc2UuYm9keS5hZ2dyZWdhdGlvbnNbJzInXTtcblxuICAgIHJldHVybiBidWNrZXRzLm1hcChpdGVtID0+IGl0ZW0ua2V5KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICB9XG59O1xuXG4vKipcbiAqIFJldHVybnMgdW5pcXVlIGNvdW50IG9mIHZ1bG5lcmFiaWxpdHkgYWxlcnRzIHVzaW5nIHNwZWNpZmljIHNldmVyaXR5LlxuICogQHBhcmFtIHsqfSBjb250ZXh0IEVuZHBvaW50IGNvbnRleHRcbiAqIEBwYXJhbSB7TnVtYmVyfSBndGUgVGltZXN0YW1wIChtcykgZnJvbVxuICogQHBhcmFtIHtOdW1iZXJ9IGx0ZSBUaW1lc3RhbXAgKG1zKSB0b1xuICogQHBhcmFtIHtTdHJpbmd9IHNldmVyaXR5IExvdywgTWVkaXVtLCBIaWdoLCBDcml0aWNhbFxuICogQHBhcmFtIHtTdHJpbmd9IGZpbHRlcnMgRS5nOiBjbHVzdGVyLm5hbWU6IHdhenVoIEFORCBydWxlLmdyb3VwczogdnVsbmVyYWJpbGl0eVxuICogQHJldHVybnMge051bWJlcn1cbiAqL1xuZXhwb3J0IGNvbnN0IHVuaXF1ZVNldmVyaXR5Q291bnQgPSBhc3luYyAoXG4gIGNvbnRleHQsXG4gIGd0ZSxcbiAgbHRlLFxuICBzZXZlcml0eSxcbiAgZmlsdGVycyxcbiAgYWxsb3dlZEFnZW50c0ZpbHRlcixcbiAgcGF0dGVybixcbikgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGJhc2UgPSB7fTtcblxuICAgIE9iamVjdC5hc3NpZ24oYmFzZSwgQmFzZShwYXR0ZXJuLCBmaWx0ZXJzLCBndGUsIGx0ZSwgYWxsb3dlZEFnZW50c0ZpbHRlcikpO1xuXG4gICAgT2JqZWN0LmFzc2lnbihiYXNlLmFnZ3MsIHtcbiAgICAgICcxJzoge1xuICAgICAgICBjYXJkaW5hbGl0eToge1xuICAgICAgICAgIGZpZWxkOiAnYWdlbnQuaWQnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGJhc2UucXVlcnkuYm9vbC5tdXN0LnB1c2goe1xuICAgICAgbWF0Y2hfcGhyYXNlOiB7XG4gICAgICAgICdkYXRhLnZ1bG5lcmFiaWxpdHkuc2V2ZXJpdHknOiB7XG4gICAgICAgICAgcXVlcnk6IHNldmVyaXR5LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY29udGV4dC5jb3JlLm9wZW5zZWFyY2guY2xpZW50LmFzQ3VycmVudFVzZXIuc2VhcmNoKHtcbiAgICAgIGluZGV4OiBwYXR0ZXJuLFxuICAgICAgYm9keTogYmFzZSxcbiAgICB9KTtcblxuICAgIHJldHVybiByZXNwb25zZS5ib2R5ICYmXG4gICAgICByZXNwb25zZS5ib2R5LmFnZ3JlZ2F0aW9ucyAmJlxuICAgICAgcmVzcG9uc2UuYm9keS5hZ2dyZWdhdGlvbnNbJzEnXSAmJlxuICAgICAgcmVzcG9uc2UuYm9keS5hZ2dyZWdhdGlvbnNbJzEnXS52YWx1ZVxuICAgICAgPyByZXNwb25zZS5ib2R5LmFnZ3JlZ2F0aW9uc1snMSddLnZhbHVlXG4gICAgICA6IDA7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHRvcFBhY2thZ2VzID0gYXN5bmMgKFxuICBjb250ZXh0LFxuICBndGUsXG4gIGx0ZSxcbiAgc2V2ZXJpdHksXG4gIGZpbHRlcnMsXG4gIGFsbG93ZWRBZ2VudHNGaWx0ZXIsXG4gIHBhdHRlcm4sXG4pID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBiYXNlID0ge307XG5cbiAgICBPYmplY3QuYXNzaWduKGJhc2UsIEJhc2UocGF0dGVybiwgZmlsdGVycywgZ3RlLCBsdGUsIGFsbG93ZWRBZ2VudHNGaWx0ZXIpKTtcblxuICAgIE9iamVjdC5hc3NpZ24oYmFzZS5hZ2dzLCB7XG4gICAgICAnMic6IHtcbiAgICAgICAgdGVybXM6IHtcbiAgICAgICAgICBmaWVsZDogJ2RhdGEudnVsbmVyYWJpbGl0eS5wYWNrYWdlLm5hbWUnLFxuICAgICAgICAgIHNpemU6IDIwLFxuICAgICAgICAgIG9yZGVyOiB7XG4gICAgICAgICAgICBfY291bnQ6ICdkZXNjJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGJhc2UucXVlcnkuYm9vbC5tdXN0LnB1c2goe1xuICAgICAgbWF0Y2hfcGhyYXNlOiB7XG4gICAgICAgICdkYXRhLnZ1bG5lcmFiaWxpdHkuc2V2ZXJpdHknOiB7XG4gICAgICAgICAgcXVlcnk6IHNldmVyaXR5LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY29udGV4dC5jb3JlLm9wZW5zZWFyY2guY2xpZW50LmFzQ3VycmVudFVzZXIuc2VhcmNoKHtcbiAgICAgIGluZGV4OiBwYXR0ZXJuLFxuICAgICAgYm9keTogYmFzZSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHsgYnVja2V0cyB9ID0gcmVzcG9uc2UuYm9keS5hZ2dyZWdhdGlvbnNbJzInXTtcblxuICAgIHJldHVybiBidWNrZXRzLm1hcChpdGVtID0+ICh7XG4gICAgICBwYWNrYWdlOiBpdGVtLmtleSxcbiAgICAgIHNldmVyaXR5OiBzZXZlcml0eSxcbiAgICB9KSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHRvcFBhY2thZ2VzV2l0aENWRSA9IGFzeW5jIChcbiAgY29udGV4dCxcbiAgZ3RlLFxuICBsdGUsXG4gIHNldmVyaXR5LFxuICBmaWx0ZXJzLFxuICBhbGxvd2VkQWdlbnRzRmlsdGVyLFxuICBwYXR0ZXJuLFxuKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgYmFzZSA9IHt9O1xuXG4gICAgT2JqZWN0LmFzc2lnbihiYXNlLCBCYXNlKHBhdHRlcm4sIGZpbHRlcnMsIGd0ZSwgbHRlLCBhbGxvd2VkQWdlbnRzRmlsdGVyKSk7XG5cbiAgICBPYmplY3QuYXNzaWduKGJhc2UuYWdncywge1xuICAgICAgJzInOiB7XG4gICAgICAgIHRlcm1zOiB7XG4gICAgICAgICAgZmllbGQ6ICdkYXRhLnZ1bG5lcmFiaWxpdHkucGFja2FnZS5uYW1lJyxcbiAgICAgICAgICBzaXplOiAzLFxuICAgICAgICAgIG9yZGVyOiB7XG4gICAgICAgICAgICBfY291bnQ6ICdkZXNjJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBhZ2dzOiB7XG4gICAgICAgICAgJzMnOiB7XG4gICAgICAgICAgICB0ZXJtczoge1xuICAgICAgICAgICAgICBmaWVsZDogJ2RhdGEudnVsbmVyYWJpbGl0eS5yZWZlcmVuY2UnLFxuICAgICAgICAgICAgICBzaXplOiAxMCxcbiAgICAgICAgICAgICAgb3JkZXI6IHtcbiAgICAgICAgICAgICAgICBfY291bnQ6ICdkZXNjJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBiYXNlLnF1ZXJ5LmJvb2wubXVzdC5wdXNoKHtcbiAgICAgIG1hdGNoX3BocmFzZToge1xuICAgICAgICAnZGF0YS52dWxuZXJhYmlsaXR5LnNldmVyaXR5Jzoge1xuICAgICAgICAgIHF1ZXJ5OiBzZXZlcml0eSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNvbnRleHQuY29yZS5vcGVuc2VhcmNoLmNsaWVudC5hc0N1cnJlbnRVc2VyLnNlYXJjaCh7XG4gICAgICBpbmRleDogcGF0dGVybixcbiAgICAgIGJvZHk6IGJhc2UsXG4gICAgfSk7XG4gICAgY29uc3QgeyBidWNrZXRzIH0gPSByZXNwb25zZS5ib2R5LmFnZ3JlZ2F0aW9uc1snMiddO1xuXG4gICAgcmV0dXJuIGJ1Y2tldHMubWFwKGl0ZW0gPT4gKHtcbiAgICAgIHBhY2thZ2U6IGl0ZW0ua2V5LFxuICAgICAgcmVmZXJlbmNlczogaXRlbVsnMyddLmJ1Y2tldHMubWFwKHJlZiA9PiByZWYua2V5KSxcbiAgICB9KSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgfVxufTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBV0EsSUFBQUEsVUFBQSxHQUFBQyxPQUFBO0FBWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTyxNQUFNQyxhQUFhLEdBQUcsTUFBQUEsQ0FDM0JDLE9BQU8sRUFDUEMsR0FBRyxFQUNIQyxHQUFHLEVBQ0hDLFFBQVEsRUFDUkMsT0FBTyxFQUNQQyxtQkFBbUIsRUFDbkJDLE9BQU8sS0FDSjtFQUNILElBQUk7SUFDRixNQUFNQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO0lBRWZDLE1BQU0sQ0FBQ0MsTUFBTSxDQUFDRixJQUFJLEVBQUUsSUFBQUcsZUFBSSxFQUFDSixPQUFPLEVBQUVGLE9BQU8sRUFBRUgsR0FBRyxFQUFFQyxHQUFHLEVBQUVHLG1CQUFtQixDQUFDLENBQUM7SUFFMUVHLE1BQU0sQ0FBQ0MsTUFBTSxDQUFDRixJQUFJLENBQUNJLElBQUksRUFBRTtNQUN2QixHQUFHLEVBQUU7UUFDSEMsS0FBSyxFQUFFO1VBQ0xDLEtBQUssRUFBRSxVQUFVO1VBQ2pCQyxJQUFJLEVBQUUsQ0FBQztVQUNQQyxLQUFLLEVBQUU7WUFDTEMsTUFBTSxFQUFFO1VBQ1Y7UUFDRjtNQUNGO0lBQ0YsQ0FBQyxDQUFDO0lBRUZULElBQUksQ0FBQ1UsS0FBSyxDQUFDQyxJQUFJLENBQUNDLElBQUksQ0FBQ0MsSUFBSSxDQUFDO01BQ3hCQyxZQUFZLEVBQUU7UUFDWiw2QkFBNkIsRUFBRTtVQUM3QkosS0FBSyxFQUFFZDtRQUNUO01BQ0Y7SUFDRixDQUFDLENBQUM7SUFFRixNQUFNbUIsUUFBUSxHQUFHLE1BQU10QixPQUFPLENBQUN1QixJQUFJLENBQUNDLFVBQVUsQ0FBQ0MsTUFBTSxDQUFDQyxhQUFhLENBQUNDLE1BQU0sQ0FBQztNQUN6RUMsS0FBSyxFQUFFdEIsT0FBTztNQUNkdUIsSUFBSSxFQUFFdEI7SUFDUixDQUFDLENBQUM7SUFDRixNQUFNO01BQUV1QjtJQUFRLENBQUMsR0FBR1IsUUFBUSxDQUFDTyxJQUFJLENBQUNFLFlBQVksQ0FBQyxHQUFHLENBQUM7SUFFbkQsT0FBT0QsT0FBTyxDQUFDRSxHQUFHLENBQUNDLElBQUksSUFBSUEsSUFBSSxDQUFDQyxHQUFHLENBQUM7RUFDdEMsQ0FBQyxDQUFDLE9BQU9DLEtBQUssRUFBRTtJQUNkLE9BQU9DLE9BQU8sQ0FBQ0MsTUFBTSxDQUFDRixLQUFLLENBQUM7RUFDOUI7QUFDRixDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQUcsT0FBQSxDQUFBdkMsYUFBQSxHQUFBQSxhQUFBO0FBUU8sTUFBTXdDLFdBQVcsR0FBRyxNQUFBQSxDQUN6QnZDLE9BQU8sRUFDUEMsR0FBRyxFQUNIQyxHQUFHLEVBQ0hFLE9BQU8sRUFDUEMsbUJBQW1CLEVBQ25CQyxPQUFPLEtBQ0o7RUFDSCxJQUFJO0lBQ0YsTUFBTUMsSUFBSSxHQUFHLENBQUMsQ0FBQztJQUVmQyxNQUFNLENBQUNDLE1BQU0sQ0FBQ0YsSUFBSSxFQUFFLElBQUFHLGVBQUksRUFBQ0osT0FBTyxFQUFFRixPQUFPLEVBQUVILEdBQUcsRUFBRUMsR0FBRyxFQUFFRyxtQkFBbUIsQ0FBQyxDQUFDO0lBRTFFRyxNQUFNLENBQUNDLE1BQU0sQ0FBQ0YsSUFBSSxDQUFDSSxJQUFJLEVBQUU7TUFDdkIsR0FBRyxFQUFFO1FBQ0hDLEtBQUssRUFBRTtVQUNMQyxLQUFLLEVBQUUsd0JBQXdCO1VBQy9CQyxJQUFJLEVBQUUsQ0FBQztVQUNQQyxLQUFLLEVBQUU7WUFDTEMsTUFBTSxFQUFFO1VBQ1Y7UUFDRjtNQUNGO0lBQ0YsQ0FBQyxDQUFDO0lBRUYsTUFBTU0sUUFBUSxHQUFHLE1BQU10QixPQUFPLENBQUN1QixJQUFJLENBQUNDLFVBQVUsQ0FBQ0MsTUFBTSxDQUFDQyxhQUFhLENBQUNDLE1BQU0sQ0FBQztNQUN6RUMsS0FBSyxFQUFFdEIsT0FBTztNQUNkdUIsSUFBSSxFQUFFdEI7SUFDUixDQUFDLENBQUM7SUFDRixNQUFNO01BQUV1QjtJQUFRLENBQUMsR0FBR1IsUUFBUSxDQUFDTyxJQUFJLENBQUNFLFlBQVksQ0FBQyxHQUFHLENBQUM7SUFFbkQsT0FBT0QsT0FBTyxDQUFDRSxHQUFHLENBQUNDLElBQUksSUFBSUEsSUFBSSxDQUFDQyxHQUFHLENBQUM7RUFDdEMsQ0FBQyxDQUFDLE9BQU9DLEtBQUssRUFBRTtJQUNkLE9BQU9DLE9BQU8sQ0FBQ0MsTUFBTSxDQUFDRixLQUFLLENBQUM7RUFDOUI7QUFDRixDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBRyxPQUFBLENBQUFDLFdBQUEsR0FBQUEsV0FBQTtBQVNPLE1BQU1DLG1CQUFtQixHQUFHLE1BQUFBLENBQ2pDeEMsT0FBTyxFQUNQQyxHQUFHLEVBQ0hDLEdBQUcsRUFDSEMsUUFBUSxFQUNSQyxPQUFPLEVBQ1BDLG1CQUFtQixFQUNuQkMsT0FBTyxLQUNKO0VBQ0gsSUFBSTtJQUNGLE1BQU1DLElBQUksR0FBRyxDQUFDLENBQUM7SUFFZkMsTUFBTSxDQUFDQyxNQUFNLENBQUNGLElBQUksRUFBRSxJQUFBRyxlQUFJLEVBQUNKLE9BQU8sRUFBRUYsT0FBTyxFQUFFSCxHQUFHLEVBQUVDLEdBQUcsRUFBRUcsbUJBQW1CLENBQUMsQ0FBQztJQUUxRUcsTUFBTSxDQUFDQyxNQUFNLENBQUNGLElBQUksQ0FBQ0ksSUFBSSxFQUFFO01BQ3ZCLEdBQUcsRUFBRTtRQUNIOEIsV0FBVyxFQUFFO1VBQ1g1QixLQUFLLEVBQUU7UUFDVDtNQUNGO0lBQ0YsQ0FBQyxDQUFDO0lBRUZOLElBQUksQ0FBQ1UsS0FBSyxDQUFDQyxJQUFJLENBQUNDLElBQUksQ0FBQ0MsSUFBSSxDQUFDO01BQ3hCQyxZQUFZLEVBQUU7UUFDWiw2QkFBNkIsRUFBRTtVQUM3QkosS0FBSyxFQUFFZDtRQUNUO01BQ0Y7SUFDRixDQUFDLENBQUM7SUFFRixNQUFNbUIsUUFBUSxHQUFHLE1BQU10QixPQUFPLENBQUN1QixJQUFJLENBQUNDLFVBQVUsQ0FBQ0MsTUFBTSxDQUFDQyxhQUFhLENBQUNDLE1BQU0sQ0FBQztNQUN6RUMsS0FBSyxFQUFFdEIsT0FBTztNQUNkdUIsSUFBSSxFQUFFdEI7SUFDUixDQUFDLENBQUM7SUFFRixPQUFPZSxRQUFRLENBQUNPLElBQUksSUFDbEJQLFFBQVEsQ0FBQ08sSUFBSSxDQUFDRSxZQUFZLElBQzFCVCxRQUFRLENBQUNPLElBQUksQ0FBQ0UsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUMvQlQsUUFBUSxDQUFDTyxJQUFJLENBQUNFLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQ1csS0FBSyxHQUNuQ3BCLFFBQVEsQ0FBQ08sSUFBSSxDQUFDRSxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUNXLEtBQUssR0FDckMsQ0FBQztFQUNQLENBQUMsQ0FBQyxPQUFPUCxLQUFLLEVBQUU7SUFDZCxPQUFPQyxPQUFPLENBQUNDLE1BQU0sQ0FBQ0YsS0FBSyxDQUFDO0VBQzlCO0FBQ0YsQ0FBQztBQUFDRyxPQUFBLENBQUFFLG1CQUFBLEdBQUFBLG1CQUFBO0FBRUssTUFBTUcsV0FBVyxHQUFHLE1BQUFBLENBQ3pCM0MsT0FBTyxFQUNQQyxHQUFHLEVBQ0hDLEdBQUcsRUFDSEMsUUFBUSxFQUNSQyxPQUFPLEVBQ1BDLG1CQUFtQixFQUNuQkMsT0FBTyxLQUNKO0VBQ0gsSUFBSTtJQUNGLE1BQU1DLElBQUksR0FBRyxDQUFDLENBQUM7SUFFZkMsTUFBTSxDQUFDQyxNQUFNLENBQUNGLElBQUksRUFBRSxJQUFBRyxlQUFJLEVBQUNKLE9BQU8sRUFBRUYsT0FBTyxFQUFFSCxHQUFHLEVBQUVDLEdBQUcsRUFBRUcsbUJBQW1CLENBQUMsQ0FBQztJQUUxRUcsTUFBTSxDQUFDQyxNQUFNLENBQUNGLElBQUksQ0FBQ0ksSUFBSSxFQUFFO01BQ3ZCLEdBQUcsRUFBRTtRQUNIQyxLQUFLLEVBQUU7VUFDTEMsS0FBSyxFQUFFLGlDQUFpQztVQUN4Q0MsSUFBSSxFQUFFLEVBQUU7VUFDUkMsS0FBSyxFQUFFO1lBQ0xDLE1BQU0sRUFBRTtVQUNWO1FBQ0Y7TUFDRjtJQUNGLENBQUMsQ0FBQztJQUVGVCxJQUFJLENBQUNVLEtBQUssQ0FBQ0MsSUFBSSxDQUFDQyxJQUFJLENBQUNDLElBQUksQ0FBQztNQUN4QkMsWUFBWSxFQUFFO1FBQ1osNkJBQTZCLEVBQUU7VUFDN0JKLEtBQUssRUFBRWQ7UUFDVDtNQUNGO0lBQ0YsQ0FBQyxDQUFDO0lBRUYsTUFBTW1CLFFBQVEsR0FBRyxNQUFNdEIsT0FBTyxDQUFDdUIsSUFBSSxDQUFDQyxVQUFVLENBQUNDLE1BQU0sQ0FBQ0MsYUFBYSxDQUFDQyxNQUFNLENBQUM7TUFDekVDLEtBQUssRUFBRXRCLE9BQU87TUFDZHVCLElBQUksRUFBRXRCO0lBQ1IsQ0FBQyxDQUFDO0lBRUYsTUFBTTtNQUFFdUI7SUFBUSxDQUFDLEdBQUdSLFFBQVEsQ0FBQ08sSUFBSSxDQUFDRSxZQUFZLENBQUMsR0FBRyxDQUFDO0lBRW5ELE9BQU9ELE9BQU8sQ0FBQ0UsR0FBRyxDQUFDQyxJQUFJLEtBQUs7TUFDMUJXLE9BQU8sRUFBRVgsSUFBSSxDQUFDQyxHQUFHO01BQ2pCL0IsUUFBUSxFQUFFQTtJQUNaLENBQUMsQ0FBQyxDQUFDO0VBQ0wsQ0FBQyxDQUFDLE9BQU9nQyxLQUFLLEVBQUU7SUFDZCxPQUFPQyxPQUFPLENBQUNDLE1BQU0sQ0FBQ0YsS0FBSyxDQUFDO0VBQzlCO0FBQ0YsQ0FBQztBQUFDRyxPQUFBLENBQUFLLFdBQUEsR0FBQUEsV0FBQTtBQUVLLE1BQU1FLGtCQUFrQixHQUFHLE1BQUFBLENBQ2hDN0MsT0FBTyxFQUNQQyxHQUFHLEVBQ0hDLEdBQUcsRUFDSEMsUUFBUSxFQUNSQyxPQUFPLEVBQ1BDLG1CQUFtQixFQUNuQkMsT0FBTyxLQUNKO0VBQ0gsSUFBSTtJQUNGLE1BQU1DLElBQUksR0FBRyxDQUFDLENBQUM7SUFFZkMsTUFBTSxDQUFDQyxNQUFNLENBQUNGLElBQUksRUFBRSxJQUFBRyxlQUFJLEVBQUNKLE9BQU8sRUFBRUYsT0FBTyxFQUFFSCxHQUFHLEVBQUVDLEdBQUcsRUFBRUcsbUJBQW1CLENBQUMsQ0FBQztJQUUxRUcsTUFBTSxDQUFDQyxNQUFNLENBQUNGLElBQUksQ0FBQ0ksSUFBSSxFQUFFO01BQ3ZCLEdBQUcsRUFBRTtRQUNIQyxLQUFLLEVBQUU7VUFDTEMsS0FBSyxFQUFFLGlDQUFpQztVQUN4Q0MsSUFBSSxFQUFFLENBQUM7VUFDUEMsS0FBSyxFQUFFO1lBQ0xDLE1BQU0sRUFBRTtVQUNWO1FBQ0YsQ0FBQztRQUNETCxJQUFJLEVBQUU7VUFDSixHQUFHLEVBQUU7WUFDSEMsS0FBSyxFQUFFO2NBQ0xDLEtBQUssRUFBRSw4QkFBOEI7Y0FDckNDLElBQUksRUFBRSxFQUFFO2NBQ1JDLEtBQUssRUFBRTtnQkFDTEMsTUFBTSxFQUFFO2NBQ1Y7WUFDRjtVQUNGO1FBQ0Y7TUFDRjtJQUNGLENBQUMsQ0FBQztJQUVGVCxJQUFJLENBQUNVLEtBQUssQ0FBQ0MsSUFBSSxDQUFDQyxJQUFJLENBQUNDLElBQUksQ0FBQztNQUN4QkMsWUFBWSxFQUFFO1FBQ1osNkJBQTZCLEVBQUU7VUFDN0JKLEtBQUssRUFBRWQ7UUFDVDtNQUNGO0lBQ0YsQ0FBQyxDQUFDO0lBRUYsTUFBTW1CLFFBQVEsR0FBRyxNQUFNdEIsT0FBTyxDQUFDdUIsSUFBSSxDQUFDQyxVQUFVLENBQUNDLE1BQU0sQ0FBQ0MsYUFBYSxDQUFDQyxNQUFNLENBQUM7TUFDekVDLEtBQUssRUFBRXRCLE9BQU87TUFDZHVCLElBQUksRUFBRXRCO0lBQ1IsQ0FBQyxDQUFDO0lBQ0YsTUFBTTtNQUFFdUI7SUFBUSxDQUFDLEdBQUdSLFFBQVEsQ0FBQ08sSUFBSSxDQUFDRSxZQUFZLENBQUMsR0FBRyxDQUFDO0lBRW5ELE9BQU9ELE9BQU8sQ0FBQ0UsR0FBRyxDQUFDQyxJQUFJLEtBQUs7TUFDMUJXLE9BQU8sRUFBRVgsSUFBSSxDQUFDQyxHQUFHO01BQ2pCWSxVQUFVLEVBQUViLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQ0gsT0FBTyxDQUFDRSxHQUFHLENBQUNlLEdBQUcsSUFBSUEsR0FBRyxDQUFDYixHQUFHO0lBQ2xELENBQUMsQ0FBQyxDQUFDO0VBQ0wsQ0FBQyxDQUFDLE9BQU9DLEtBQUssRUFBRTtJQUNkLE9BQU9DLE9BQU8sQ0FBQ0MsTUFBTSxDQUFDRixLQUFLLENBQUM7RUFDOUI7QUFDRixDQUFDO0FBQUNHLE9BQUEsQ0FBQU8sa0JBQUEsR0FBQUEsa0JBQUEifQ==