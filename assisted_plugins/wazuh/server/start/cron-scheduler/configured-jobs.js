"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.configuredJobs = void 0;
var _index = require("./index");
const configuredJobs = async (context, params) => {
  const {
    host,
    jobName
  } = params;
  return checkCluster(await checkConfiguration(context, getJobs({
    jobName,
    host
  })));
};
exports.configuredJobs = configuredJobs;
const getJobs = params => {
  const {
    host,
    jobName
  } = params;
  if (!jobName) return {
    jobObj: _index.jobs,
    host
  };
  return {
    jobObj: {
      [jobName]: _index.jobs[jobName]
    },
    host
  };
};
const checkCluster = params => {
  const {
    host
  } = params;
  const newJobObj = JSON.parse(JSON.stringify(params.jobObj));
  if (host && host.cluster_info && host.cluster_info.status === 'enabled') {
    ['manager-stats-remoted', 'manager-stats-analysisd'].forEach(item => {
      newJobObj[item] && (newJobObj[item].status = false);
    });
  } else if (host && host.cluster_info && host.cluster_info.status === 'disabled') {
    ['cluster-stats-remoted', 'cluster-stats-analysisd'].forEach(item => {
      newJobObj[item] && (newJobObj[item].status = false);
    });
  } else if (host && !host.cluster_info) {
    Object.keys(newJobObj).forEach(key => newJobObj[key].status = false);
  }
  return newJobObj;
};
const checkConfiguration = async (context, params) => {
  const {
    jobObj,
    host
  } = params;
  const config = await context.wazuh_core.configuration.get();
  const cronSettigns = Object.keys(config).filter(checkSetting);
  cronSettigns.forEach(setting => applySettings(setting, config[setting], jobObj));
  return {
    jobObj,
    host
  };
};
const cronRegx = /cron.(?<task>statistics).((?<index>\w+)\.)?(?<config>\w+)$/;
const checkSetting = setting => cronRegx.test(setting);
const applySettings = (setting, value, jobObj) => {
  const {
    task,
    index,
    config
  } = cronRegx.exec(setting).groups;
  Object.keys(jobObj).forEach(key => {
    if (task === 'statistics') {
      applyStatisticSetting(jobObj[key], index, config, value);
    } else if (!key.includes(task)) {
      return;
    } else {
      applySetting(jobObj[key], index, config, value);
    }
  });
};
const applySetting = (job, index, config, value) => {
  if (index) {
    job[index][config] = value;
  } else {
    job[config] = value;
  }
};
const applyStatisticSetting = (job, index, config, value) => {
  if (index) {
    job[index][config] = value;
  } else {
    job[config] = value;
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW5kZXgiLCJyZXF1aXJlIiwiY29uZmlndXJlZEpvYnMiLCJjb250ZXh0IiwicGFyYW1zIiwiaG9zdCIsImpvYk5hbWUiLCJjaGVja0NsdXN0ZXIiLCJjaGVja0NvbmZpZ3VyYXRpb24iLCJnZXRKb2JzIiwiZXhwb3J0cyIsImpvYk9iaiIsImpvYnMiLCJuZXdKb2JPYmoiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJjbHVzdGVyX2luZm8iLCJzdGF0dXMiLCJmb3JFYWNoIiwiaXRlbSIsIk9iamVjdCIsImtleXMiLCJrZXkiLCJjb25maWciLCJ3YXp1aF9jb3JlIiwiY29uZmlndXJhdGlvbiIsImdldCIsImNyb25TZXR0aWducyIsImZpbHRlciIsImNoZWNrU2V0dGluZyIsInNldHRpbmciLCJhcHBseVNldHRpbmdzIiwiY3JvblJlZ3giLCJ0ZXN0IiwidmFsdWUiLCJ0YXNrIiwiaW5kZXgiLCJleGVjIiwiZ3JvdXBzIiwiYXBwbHlTdGF0aXN0aWNTZXR0aW5nIiwiaW5jbHVkZXMiLCJhcHBseVNldHRpbmciLCJqb2IiXSwic291cmNlcyI6WyJjb25maWd1cmVkLWpvYnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgam9icyB9IGZyb20gJy4vaW5kZXgnO1xuaW1wb3J0IHsgSUFwaSB9IGZyb20gJy4vYXBpUmVxdWVzdCc7XG5pbXBvcnQgeyBJSm9iIH0gZnJvbSAnLi9wcmVkZWZpbmVkLWpvYnMnO1xuXG5leHBvcnQgY29uc3QgY29uZmlndXJlZEpvYnMgPSBhc3luYyAoXG4gIGNvbnRleHQsXG4gIHBhcmFtczoge1xuICAgIGpvYk5hbWU/OiBzdHJpbmc7XG4gICAgaG9zdD86IElBcGk7XG4gIH0sXG4pID0+IHtcbiAgY29uc3QgeyBob3N0LCBqb2JOYW1lIH0gPSBwYXJhbXM7XG4gIHJldHVybiBjaGVja0NsdXN0ZXIoXG4gICAgYXdhaXQgY2hlY2tDb25maWd1cmF0aW9uKGNvbnRleHQsIGdldEpvYnMoeyBqb2JOYW1lLCBob3N0IH0pKSxcbiAgKTtcbn07XG5cbmNvbnN0IGdldEpvYnMgPSAocGFyYW1zOiB7IGpvYk5hbWU/OiBzdHJpbmc7IGhvc3Q/OiBJQXBpIH0pID0+IHtcbiAgY29uc3QgeyBob3N0LCBqb2JOYW1lIH0gPSBwYXJhbXM7XG4gIGlmICgham9iTmFtZSkgcmV0dXJuIHsgam9iT2JqOiBqb2JzLCBob3N0IH07XG4gIHJldHVybiB7IGpvYk9iajogeyBbam9iTmFtZV06IGpvYnNbam9iTmFtZV0gfSwgaG9zdCB9O1xufTtcblxuY29uc3QgY2hlY2tDbHVzdGVyID0gKHBhcmFtczoge1xuICBqb2JPYmo6IHsgW2tleTogc3RyaW5nXTogSUpvYiB9O1xuICBob3N0PzogSUFwaTtcbn0pID0+IHtcbiAgY29uc3QgeyBob3N0IH0gPSBwYXJhbXM7XG4gIGNvbnN0IG5ld0pvYk9iaiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocGFyYW1zLmpvYk9iaikpO1xuICBpZiAoaG9zdCAmJiBob3N0LmNsdXN0ZXJfaW5mbyAmJiBob3N0LmNsdXN0ZXJfaW5mby5zdGF0dXMgPT09ICdlbmFibGVkJykge1xuICAgIFsnbWFuYWdlci1zdGF0cy1yZW1vdGVkJywgJ21hbmFnZXItc3RhdHMtYW5hbHlzaXNkJ10uZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIG5ld0pvYk9ialtpdGVtXSAmJiAobmV3Sm9iT2JqW2l0ZW1dLnN0YXR1cyA9IGZhbHNlKTtcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChcbiAgICBob3N0ICYmXG4gICAgaG9zdC5jbHVzdGVyX2luZm8gJiZcbiAgICBob3N0LmNsdXN0ZXJfaW5mby5zdGF0dXMgPT09ICdkaXNhYmxlZCdcbiAgKSB7XG4gICAgWydjbHVzdGVyLXN0YXRzLXJlbW90ZWQnLCAnY2x1c3Rlci1zdGF0cy1hbmFseXNpc2QnXS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgbmV3Sm9iT2JqW2l0ZW1dICYmIChuZXdKb2JPYmpbaXRlbV0uc3RhdHVzID0gZmFsc2UpO1xuICAgIH0pO1xuICB9IGVsc2UgaWYgKGhvc3QgJiYgIWhvc3QuY2x1c3Rlcl9pbmZvKSB7XG4gICAgT2JqZWN0LmtleXMobmV3Sm9iT2JqKS5mb3JFYWNoKGtleSA9PiAobmV3Sm9iT2JqW2tleV0uc3RhdHVzID0gZmFsc2UpKTtcbiAgfVxuICByZXR1cm4gbmV3Sm9iT2JqO1xufTtcblxuY29uc3QgY2hlY2tDb25maWd1cmF0aW9uID0gYXN5bmMgKFxuICBjb250ZXh0LFxuICBwYXJhbXM6IHtcbiAgICBqb2JPYmo6IHsgW2tleTogc3RyaW5nXTogSUpvYiB9O1xuICAgIGhvc3Q/OiBJQXBpO1xuICB9LFxuKSA9PiB7XG4gIGNvbnN0IHsgam9iT2JqLCBob3N0IH0gPSBwYXJhbXM7XG4gIGNvbnN0IGNvbmZpZyA9IGF3YWl0IGNvbnRleHQud2F6dWhfY29yZS5jb25maWd1cmF0aW9uLmdldCgpO1xuICBjb25zdCBjcm9uU2V0dGlnbnMgPSBPYmplY3Qua2V5cyhjb25maWcpLmZpbHRlcihjaGVja1NldHRpbmcpO1xuICBjcm9uU2V0dGlnbnMuZm9yRWFjaChzZXR0aW5nID0+XG4gICAgYXBwbHlTZXR0aW5ncyhzZXR0aW5nLCBjb25maWdbc2V0dGluZ10sIGpvYk9iaiksXG4gICk7XG4gIHJldHVybiB7IGpvYk9iaiwgaG9zdCB9O1xufTtcbmNvbnN0IGNyb25SZWd4ID0gL2Nyb24uKD88dGFzaz5zdGF0aXN0aWNzKS4oKD88aW5kZXg+XFx3KylcXC4pPyg/PGNvbmZpZz5cXHcrKSQvO1xuXG5jb25zdCBjaGVja1NldHRpbmcgPSBzZXR0aW5nID0+IGNyb25SZWd4LnRlc3Qoc2V0dGluZyk7XG5cbmNvbnN0IGFwcGx5U2V0dGluZ3MgPSAoc2V0dGluZywgdmFsdWUsIGpvYk9iajogeyBba2V5OiBzdHJpbmddOiBJSm9iIH0pID0+IHtcbiAgY29uc3QgeyB0YXNrLCBpbmRleCwgY29uZmlnIH0gPSBjcm9uUmVneC5leGVjKHNldHRpbmcpLmdyb3VwcztcbiAgT2JqZWN0LmtleXMoam9iT2JqKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgaWYgKHRhc2sgPT09ICdzdGF0aXN0aWNzJykge1xuICAgICAgYXBwbHlTdGF0aXN0aWNTZXR0aW5nKGpvYk9ialtrZXldLCBpbmRleCwgY29uZmlnLCB2YWx1ZSk7XG4gICAgfSBlbHNlIGlmICgha2V5LmluY2x1ZGVzKHRhc2spKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIGFwcGx5U2V0dGluZyhqb2JPYmpba2V5XSwgaW5kZXgsIGNvbmZpZywgdmFsdWUpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5jb25zdCBhcHBseVNldHRpbmcgPSAoam9iLCBpbmRleCwgY29uZmlnLCB2YWx1ZSkgPT4ge1xuICBpZiAoaW5kZXgpIHtcbiAgICBqb2JbaW5kZXhdW2NvbmZpZ10gPSB2YWx1ZTtcbiAgfSBlbHNlIHtcbiAgICBqb2JbY29uZmlnXSA9IHZhbHVlO1xuICB9XG59O1xuXG5jb25zdCBhcHBseVN0YXRpc3RpY1NldHRpbmcgPSAoam9iLCBpbmRleCwgY29uZmlnLCB2YWx1ZSkgPT4ge1xuICBpZiAoaW5kZXgpIHtcbiAgICBqb2JbaW5kZXhdW2NvbmZpZ10gPSB2YWx1ZTtcbiAgfSBlbHNlIHtcbiAgICBqb2JbY29uZmlnXSA9IHZhbHVlO1xuICB9XG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFJTyxNQUFNQyxjQUFjLEdBQUcsTUFBQUEsQ0FDNUJDLE9BQU8sRUFDUEMsTUFHQyxLQUNFO0VBQ0gsTUFBTTtJQUFFQyxJQUFJO0lBQUVDO0VBQVEsQ0FBQyxHQUFHRixNQUFNO0VBQ2hDLE9BQU9HLFlBQVksQ0FDakIsTUFBTUMsa0JBQWtCLENBQUNMLE9BQU8sRUFBRU0sT0FBTyxDQUFDO0lBQUVILE9BQU87SUFBRUQ7RUFBSyxDQUFDLENBQUMsQ0FDOUQsQ0FBQztBQUNILENBQUM7QUFBQ0ssT0FBQSxDQUFBUixjQUFBLEdBQUFBLGNBQUE7QUFFRixNQUFNTyxPQUFPLEdBQUlMLE1BQXlDLElBQUs7RUFDN0QsTUFBTTtJQUFFQyxJQUFJO0lBQUVDO0VBQVEsQ0FBQyxHQUFHRixNQUFNO0VBQ2hDLElBQUksQ0FBQ0UsT0FBTyxFQUFFLE9BQU87SUFBRUssTUFBTSxFQUFFQyxXQUFJO0lBQUVQO0VBQUssQ0FBQztFQUMzQyxPQUFPO0lBQUVNLE1BQU0sRUFBRTtNQUFFLENBQUNMLE9BQU8sR0FBR00sV0FBSSxDQUFDTixPQUFPO0lBQUUsQ0FBQztJQUFFRDtFQUFLLENBQUM7QUFDdkQsQ0FBQztBQUVELE1BQU1FLFlBQVksR0FBSUgsTUFHckIsSUFBSztFQUNKLE1BQU07SUFBRUM7RUFBSyxDQUFDLEdBQUdELE1BQU07RUFDdkIsTUFBTVMsU0FBUyxHQUFHQyxJQUFJLENBQUNDLEtBQUssQ0FBQ0QsSUFBSSxDQUFDRSxTQUFTLENBQUNaLE1BQU0sQ0FBQ08sTUFBTSxDQUFDLENBQUM7RUFDM0QsSUFBSU4sSUFBSSxJQUFJQSxJQUFJLENBQUNZLFlBQVksSUFBSVosSUFBSSxDQUFDWSxZQUFZLENBQUNDLE1BQU0sS0FBSyxTQUFTLEVBQUU7SUFDdkUsQ0FBQyx1QkFBdUIsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDQyxPQUFPLENBQUNDLElBQUksSUFBSTtNQUNuRVAsU0FBUyxDQUFDTyxJQUFJLENBQUMsS0FBS1AsU0FBUyxDQUFDTyxJQUFJLENBQUMsQ0FBQ0YsTUFBTSxHQUFHLEtBQUssQ0FBQztJQUNyRCxDQUFDLENBQUM7RUFDSixDQUFDLE1BQU0sSUFDTGIsSUFBSSxJQUNKQSxJQUFJLENBQUNZLFlBQVksSUFDakJaLElBQUksQ0FBQ1ksWUFBWSxDQUFDQyxNQUFNLEtBQUssVUFBVSxFQUN2QztJQUNBLENBQUMsdUJBQXVCLEVBQUUseUJBQXlCLENBQUMsQ0FBQ0MsT0FBTyxDQUFDQyxJQUFJLElBQUk7TUFDbkVQLFNBQVMsQ0FBQ08sSUFBSSxDQUFDLEtBQUtQLFNBQVMsQ0FBQ08sSUFBSSxDQUFDLENBQUNGLE1BQU0sR0FBRyxLQUFLLENBQUM7SUFDckQsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxNQUFNLElBQUliLElBQUksSUFBSSxDQUFDQSxJQUFJLENBQUNZLFlBQVksRUFBRTtJQUNyQ0ksTUFBTSxDQUFDQyxJQUFJLENBQUNULFNBQVMsQ0FBQyxDQUFDTSxPQUFPLENBQUNJLEdBQUcsSUFBS1YsU0FBUyxDQUFDVSxHQUFHLENBQUMsQ0FBQ0wsTUFBTSxHQUFHLEtBQU0sQ0FBQztFQUN4RTtFQUNBLE9BQU9MLFNBQVM7QUFDbEIsQ0FBQztBQUVELE1BQU1MLGtCQUFrQixHQUFHLE1BQUFBLENBQ3pCTCxPQUFPLEVBQ1BDLE1BR0MsS0FDRTtFQUNILE1BQU07SUFBRU8sTUFBTTtJQUFFTjtFQUFLLENBQUMsR0FBR0QsTUFBTTtFQUMvQixNQUFNb0IsTUFBTSxHQUFHLE1BQU1yQixPQUFPLENBQUNzQixVQUFVLENBQUNDLGFBQWEsQ0FBQ0MsR0FBRyxDQUFDLENBQUM7RUFDM0QsTUFBTUMsWUFBWSxHQUFHUCxNQUFNLENBQUNDLElBQUksQ0FBQ0UsTUFBTSxDQUFDLENBQUNLLE1BQU0sQ0FBQ0MsWUFBWSxDQUFDO0VBQzdERixZQUFZLENBQUNULE9BQU8sQ0FBQ1ksT0FBTyxJQUMxQkMsYUFBYSxDQUFDRCxPQUFPLEVBQUVQLE1BQU0sQ0FBQ08sT0FBTyxDQUFDLEVBQUVwQixNQUFNLENBQ2hELENBQUM7RUFDRCxPQUFPO0lBQUVBLE1BQU07SUFBRU47RUFBSyxDQUFDO0FBQ3pCLENBQUM7QUFDRCxNQUFNNEIsUUFBUSxHQUFHLDREQUE0RDtBQUU3RSxNQUFNSCxZQUFZLEdBQUdDLE9BQU8sSUFBSUUsUUFBUSxDQUFDQyxJQUFJLENBQUNILE9BQU8sQ0FBQztBQUV0RCxNQUFNQyxhQUFhLEdBQUdBLENBQUNELE9BQU8sRUFBRUksS0FBSyxFQUFFeEIsTUFBK0IsS0FBSztFQUN6RSxNQUFNO0lBQUV5QixJQUFJO0lBQUVDLEtBQUs7SUFBRWI7RUFBTyxDQUFDLEdBQUdTLFFBQVEsQ0FBQ0ssSUFBSSxDQUFDUCxPQUFPLENBQUMsQ0FBQ1EsTUFBTTtFQUM3RGxCLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDWCxNQUFNLENBQUMsQ0FBQ1EsT0FBTyxDQUFDSSxHQUFHLElBQUk7SUFDakMsSUFBSWEsSUFBSSxLQUFLLFlBQVksRUFBRTtNQUN6QkkscUJBQXFCLENBQUM3QixNQUFNLENBQUNZLEdBQUcsQ0FBQyxFQUFFYyxLQUFLLEVBQUViLE1BQU0sRUFBRVcsS0FBSyxDQUFDO0lBQzFELENBQUMsTUFBTSxJQUFJLENBQUNaLEdBQUcsQ0FBQ2tCLFFBQVEsQ0FBQ0wsSUFBSSxDQUFDLEVBQUU7TUFDOUI7SUFDRixDQUFDLE1BQU07TUFDTE0sWUFBWSxDQUFDL0IsTUFBTSxDQUFDWSxHQUFHLENBQUMsRUFBRWMsS0FBSyxFQUFFYixNQUFNLEVBQUVXLEtBQUssQ0FBQztJQUNqRDtFQUNGLENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRCxNQUFNTyxZQUFZLEdBQUdBLENBQUNDLEdBQUcsRUFBRU4sS0FBSyxFQUFFYixNQUFNLEVBQUVXLEtBQUssS0FBSztFQUNsRCxJQUFJRSxLQUFLLEVBQUU7SUFDVE0sR0FBRyxDQUFDTixLQUFLLENBQUMsQ0FBQ2IsTUFBTSxDQUFDLEdBQUdXLEtBQUs7RUFDNUIsQ0FBQyxNQUFNO0lBQ0xRLEdBQUcsQ0FBQ25CLE1BQU0sQ0FBQyxHQUFHVyxLQUFLO0VBQ3JCO0FBQ0YsQ0FBQztBQUVELE1BQU1LLHFCQUFxQixHQUFHQSxDQUFDRyxHQUFHLEVBQUVOLEtBQUssRUFBRWIsTUFBTSxFQUFFVyxLQUFLLEtBQUs7RUFDM0QsSUFBSUUsS0FBSyxFQUFFO0lBQ1RNLEdBQUcsQ0FBQ04sS0FBSyxDQUFDLENBQUNiLE1BQU0sQ0FBQyxHQUFHVyxLQUFLO0VBQzVCLENBQUMsTUFBTTtJQUNMUSxHQUFHLENBQUNuQixNQUFNLENBQUMsR0FBR1csS0FBSztFQUNyQjtBQUNGLENBQUMifQ==