"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SaveDocument = void 0;
var _indexDate = require("../../lib/index-date");
var _constants = require("../../../common/constants");
var _tryCatchForIndexPermissionError = require("../tryCatchForIndexPermissionError");
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
class SaveDocument {
  constructor(context) {
    _defineProperty(this, "context", void 0);
    _defineProperty(this, "esClientInternalUser", void 0);
    this.context = context;
    this.esClientInternalUser = context.core.opensearch.client.asInternalUser;
  }
  async save(doc, indexConfig) {
    const {
      name,
      creation,
      mapping,
      shards,
      replicas
    } = indexConfig;
    const index = await this.addIndexPrefix(name);
    const indexCreation = `${index}-${(0, _indexDate.indexDate)(creation)}`;
    try {
      await this.checkIndexAndCreateIfNotExists(indexCreation, shards, replicas);
      const createDocumentObject = this.createDocument(doc, indexCreation, mapping);
      this.context.wazuh.logger.debug('Bulk data');
      const response = await this.esClientInternalUser.bulk(createDocumentObject);
      this.context.wazuh.logger.debug(`Bulked data. Response of creating the new document ${JSON.stringify(response)}`);
    } catch (error) {
      if (error.status === 403) {
        throw {
          error: 403,
          message: `Authorization Exception in the index "${index}"`
        };
      }
      if (error.status === 409) {
        throw {
          error: 409,
          message: `Duplicate index-pattern: ${index}`
        };
      }
      throw error;
    }
  }
  async checkIndexAndCreateIfNotExists(index, shards, replicas) {
    try {
      await (0, _tryCatchForIndexPermissionError.tryCatchForIndexPermissionError)(index)(async () => {
        this.context.wazuh.logger.debug(`Checking the existence of ${index} index`);
        const exists = await this.esClientInternalUser.indices.exists({
          index
        });
        this.context.wazuh.logger.debug(`Index '${index}' exists? ${exists.body}`);
        if (!exists.body) {
          this.context.wazuh.logger.debug(`Creating ${index} index`);
          await this.esClientInternalUser.indices.create({
            index,
            body: {
              settings: {
                index: {
                  number_of_shards: shards !== null && shards !== void 0 ? shards : _constants.WAZUH_STATISTICS_DEFAULT_INDICES_SHARDS,
                  number_of_replicas: replicas !== null && replicas !== void 0 ? replicas : _constants.WAZUH_STATISTICS_DEFAULT_INDICES_REPLICAS
                }
              }
            }
          });
          this.context.wazuh.logger.info(`${index} index created`);
        }
      })();
    } catch (error) {
      this.checkDuplicateIndexError(error);
    }
  }
  checkDuplicateIndexError(error) {
    var _error$body;
    if (!['resource_already_exists_exception'].includes(error === null || error === void 0 || (_error$body = error.body) === null || _error$body === void 0 || (_error$body = _error$body.error) === null || _error$body === void 0 ? void 0 : _error$body.type)) {
      throw error;
    }
  }
  createDocument(doc, index, mapping) {
    const createDocumentObject = {
      index,
      body: doc.map(item => `{"index": { "_index": "${index}" }}\n${JSON.stringify({
        ...this.buildData(item, mapping),
        timestamp: new Date(Date.now()).toISOString()
      })}\n`).join('')
    };
    this.context.wazuh.logger.debug(`Document object: ${JSON.stringify(createDocumentObject)}`);
    return createDocumentObject;
  }
  buildData(item, mapping) {
    const getItemArray = (array, index) => {
      return JSON.stringify(array[index || 0]);
    };
    const getValue = (key, item) => {
      const keys = key.split('.');
      if (keys.length === 1) {
        if (key.match(/\[.*\]/)) {
          return getItemArray(item[key.replace(/\[.*\]/, '')], key.match(/\[(.*)\]/)[1]);
        }
        return JSON.stringify(item[key]);
      }
      return getValue(keys.slice(1).join('.'), item[keys[0]]);
    };
    if (mapping) {
      let data;
      data = mapping.replace(/\${([a-z|A-Z|0-9|\.\-\_\[.*\]]+)}/gi, (...key) => getValue(key[1], item));
      return JSON.parse(data);
    }
    if (typeof item.data === 'object') {
      return item.data;
    }
    return {
      data: item.data
    };
  }
  async addIndexPrefix(index) {
    const prefix = await this.context.wazuh_core.configuration.get('cron.prefix');
    return `${prefix}-${index}`;
  }
}
exports.SaveDocument = SaveDocument;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW5kZXhEYXRlIiwicmVxdWlyZSIsIl9jb25zdGFudHMiLCJfdHJ5Q2F0Y2hGb3JJbmRleFBlcm1pc3Npb25FcnJvciIsIl9kZWZpbmVQcm9wZXJ0eSIsIm9iaiIsImtleSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImFyZyIsIl90b1ByaW1pdGl2ZSIsIlN0cmluZyIsImlucHV0IiwiaGludCIsInByaW0iLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsInVuZGVmaW5lZCIsInJlcyIsImNhbGwiLCJUeXBlRXJyb3IiLCJOdW1iZXIiLCJTYXZlRG9jdW1lbnQiLCJjb25zdHJ1Y3RvciIsImNvbnRleHQiLCJlc0NsaWVudEludGVybmFsVXNlciIsImNvcmUiLCJvcGVuc2VhcmNoIiwiY2xpZW50IiwiYXNJbnRlcm5hbFVzZXIiLCJzYXZlIiwiZG9jIiwiaW5kZXhDb25maWciLCJuYW1lIiwiY3JlYXRpb24iLCJtYXBwaW5nIiwic2hhcmRzIiwicmVwbGljYXMiLCJpbmRleCIsImFkZEluZGV4UHJlZml4IiwiaW5kZXhDcmVhdGlvbiIsImluZGV4RGF0ZSIsImNoZWNrSW5kZXhBbmRDcmVhdGVJZk5vdEV4aXN0cyIsImNyZWF0ZURvY3VtZW50T2JqZWN0IiwiY3JlYXRlRG9jdW1lbnQiLCJ3YXp1aCIsImxvZ2dlciIsImRlYnVnIiwicmVzcG9uc2UiLCJidWxrIiwiSlNPTiIsInN0cmluZ2lmeSIsImVycm9yIiwic3RhdHVzIiwibWVzc2FnZSIsInRyeUNhdGNoRm9ySW5kZXhQZXJtaXNzaW9uRXJyb3IiLCJleGlzdHMiLCJpbmRpY2VzIiwiYm9keSIsImNyZWF0ZSIsInNldHRpbmdzIiwibnVtYmVyX29mX3NoYXJkcyIsIldBWlVIX1NUQVRJU1RJQ1NfREVGQVVMVF9JTkRJQ0VTX1NIQVJEUyIsIm51bWJlcl9vZl9yZXBsaWNhcyIsIldBWlVIX1NUQVRJU1RJQ1NfREVGQVVMVF9JTkRJQ0VTX1JFUExJQ0FTIiwiaW5mbyIsImNoZWNrRHVwbGljYXRlSW5kZXhFcnJvciIsIl9lcnJvciRib2R5IiwiaW5jbHVkZXMiLCJ0eXBlIiwibWFwIiwiaXRlbSIsImJ1aWxkRGF0YSIsInRpbWVzdGFtcCIsIkRhdGUiLCJub3ciLCJ0b0lTT1N0cmluZyIsImpvaW4iLCJnZXRJdGVtQXJyYXkiLCJhcnJheSIsImdldFZhbHVlIiwia2V5cyIsInNwbGl0IiwibGVuZ3RoIiwibWF0Y2giLCJyZXBsYWNlIiwic2xpY2UiLCJkYXRhIiwicGFyc2UiLCJwcmVmaXgiLCJ3YXp1aF9jb3JlIiwiY29uZmlndXJhdGlvbiIsImdldCIsImV4cG9ydHMiXSwic291cmNlcyI6WyJzYXZlLWRvY3VtZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJ1bGtJbmRleERvY3VtZW50c1BhcmFtcyB9IGZyb20gJ2VsYXN0aWNzZWFyY2gnO1xuaW1wb3J0IHsgaW5kZXhEYXRlIH0gZnJvbSAnLi4vLi4vbGliL2luZGV4LWRhdGUnO1xuaW1wb3J0IHtcbiAgV0FaVUhfU1RBVElTVElDU19ERUZBVUxUX0lORElDRVNfU0hBUkRTLFxuICBXQVpVSF9TVEFUSVNUSUNTX0RFRkFVTFRfSU5ESUNFU19SRVBMSUNBUyxcbn0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2NvbnN0YW50cyc7XG5pbXBvcnQgeyB0cnlDYXRjaEZvckluZGV4UGVybWlzc2lvbkVycm9yIH0gZnJvbSAnLi4vdHJ5Q2F0Y2hGb3JJbmRleFBlcm1pc3Npb25FcnJvcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUluZGV4Q29uZmlndXJhdGlvbiB7XG4gIG5hbWU6IHN0cmluZztcbiAgY3JlYXRpb246ICdoJyB8ICdkJyB8ICd3JyB8ICdtJztcbiAgbWFwcGluZz86IHN0cmluZztcbiAgc2hhcmRzPzogbnVtYmVyO1xuICByZXBsaWNhcz86IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIFNhdmVEb2N1bWVudCB7XG4gIGNvbnRleHQ6IGFueTtcbiAgZXNDbGllbnRJbnRlcm5hbFVzZXI6IGFueTtcblxuICBjb25zdHJ1Y3Rvcihjb250ZXh0KSB7XG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICB0aGlzLmVzQ2xpZW50SW50ZXJuYWxVc2VyID0gY29udGV4dC5jb3JlLm9wZW5zZWFyY2guY2xpZW50LmFzSW50ZXJuYWxVc2VyO1xuICB9XG5cbiAgYXN5bmMgc2F2ZShkb2M6IG9iamVjdFtdLCBpbmRleENvbmZpZzogSUluZGV4Q29uZmlndXJhdGlvbikge1xuICAgIGNvbnN0IHsgbmFtZSwgY3JlYXRpb24sIG1hcHBpbmcsIHNoYXJkcywgcmVwbGljYXMgfSA9IGluZGV4Q29uZmlnO1xuICAgIGNvbnN0IGluZGV4ID0gYXdhaXQgdGhpcy5hZGRJbmRleFByZWZpeChuYW1lKTtcbiAgICBjb25zdCBpbmRleENyZWF0aW9uID0gYCR7aW5kZXh9LSR7aW5kZXhEYXRlKGNyZWF0aW9uKX1gO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNoZWNrSW5kZXhBbmRDcmVhdGVJZk5vdEV4aXN0cyhcbiAgICAgICAgaW5kZXhDcmVhdGlvbixcbiAgICAgICAgc2hhcmRzLFxuICAgICAgICByZXBsaWNhcyxcbiAgICAgICk7XG4gICAgICBjb25zdCBjcmVhdGVEb2N1bWVudE9iamVjdCA9IHRoaXMuY3JlYXRlRG9jdW1lbnQoXG4gICAgICAgIGRvYyxcbiAgICAgICAgaW5kZXhDcmVhdGlvbixcbiAgICAgICAgbWFwcGluZyxcbiAgICAgICk7XG4gICAgICB0aGlzLmNvbnRleHQud2F6dWgubG9nZ2VyLmRlYnVnKCdCdWxrIGRhdGEnKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5lc0NsaWVudEludGVybmFsVXNlci5idWxrKFxuICAgICAgICBjcmVhdGVEb2N1bWVudE9iamVjdCxcbiAgICAgICk7XG4gICAgICB0aGlzLmNvbnRleHQud2F6dWgubG9nZ2VyLmRlYnVnKFxuICAgICAgICBgQnVsa2VkIGRhdGEuIFJlc3BvbnNlIG9mIGNyZWF0aW5nIHRoZSBuZXcgZG9jdW1lbnQgJHtKU09OLnN0cmluZ2lmeShcbiAgICAgICAgICByZXNwb25zZSxcbiAgICAgICAgKX1gLFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICAgIHRocm93IHtcbiAgICAgICAgICBlcnJvcjogNDAzLFxuICAgICAgICAgIG1lc3NhZ2U6IGBBdXRob3JpemF0aW9uIEV4Y2VwdGlvbiBpbiB0aGUgaW5kZXggXCIke2luZGV4fVwiYCxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDQwOSkge1xuICAgICAgICB0aHJvdyB7IGVycm9yOiA0MDksIG1lc3NhZ2U6IGBEdXBsaWNhdGUgaW5kZXgtcGF0dGVybjogJHtpbmRleH1gIH07XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNoZWNrSW5kZXhBbmRDcmVhdGVJZk5vdEV4aXN0cyhpbmRleCwgc2hhcmRzLCByZXBsaWNhcykge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0cnlDYXRjaEZvckluZGV4UGVybWlzc2lvbkVycm9yKGluZGV4KShhc3luYyAoKSA9PiB7XG4gICAgICAgIHRoaXMuY29udGV4dC53YXp1aC5sb2dnZXIuZGVidWcoXG4gICAgICAgICAgYENoZWNraW5nIHRoZSBleGlzdGVuY2Ugb2YgJHtpbmRleH0gaW5kZXhgLFxuICAgICAgICApO1xuICAgICAgICBjb25zdCBleGlzdHMgPSBhd2FpdCB0aGlzLmVzQ2xpZW50SW50ZXJuYWxVc2VyLmluZGljZXMuZXhpc3RzKHtcbiAgICAgICAgICBpbmRleCxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29udGV4dC53YXp1aC5sb2dnZXIuZGVidWcoXG4gICAgICAgICAgYEluZGV4ICcke2luZGV4fScgZXhpc3RzPyAke2V4aXN0cy5ib2R5fWAsXG4gICAgICAgICk7XG4gICAgICAgIGlmICghZXhpc3RzLmJvZHkpIHtcbiAgICAgICAgICB0aGlzLmNvbnRleHQud2F6dWgubG9nZ2VyLmRlYnVnKGBDcmVhdGluZyAke2luZGV4fSBpbmRleGApO1xuICAgICAgICAgIGF3YWl0IHRoaXMuZXNDbGllbnRJbnRlcm5hbFVzZXIuaW5kaWNlcy5jcmVhdGUoe1xuICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICBib2R5OiB7XG4gICAgICAgICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgICAgICAgaW5kZXg6IHtcbiAgICAgICAgICAgICAgICAgIG51bWJlcl9vZl9zaGFyZHM6XG4gICAgICAgICAgICAgICAgICAgIHNoYXJkcyA/PyBXQVpVSF9TVEFUSVNUSUNTX0RFRkFVTFRfSU5ESUNFU19TSEFSRFMsXG4gICAgICAgICAgICAgICAgICBudW1iZXJfb2ZfcmVwbGljYXM6XG4gICAgICAgICAgICAgICAgICAgIHJlcGxpY2FzID8/IFdBWlVIX1NUQVRJU1RJQ1NfREVGQVVMVF9JTkRJQ0VTX1JFUExJQ0FTLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMuY29udGV4dC53YXp1aC5sb2dnZXIuaW5mbyhgJHtpbmRleH0gaW5kZXggY3JlYXRlZGApO1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmNoZWNrRHVwbGljYXRlSW5kZXhFcnJvcihlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0R1cGxpY2F0ZUluZGV4RXJyb3IoZXJyb3I6IGFueSkge1xuICAgIGlmIChcbiAgICAgICFbJ3Jlc291cmNlX2FscmVhZHlfZXhpc3RzX2V4Y2VwdGlvbiddLmluY2x1ZGVzKGVycm9yPy5ib2R5Py5lcnJvcj8udHlwZSlcbiAgICApIHtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRG9jdW1lbnQoXG4gICAgZG9jLFxuICAgIGluZGV4LFxuICAgIG1hcHBpbmc6IHN0cmluZyxcbiAgKTogQnVsa0luZGV4RG9jdW1lbnRzUGFyYW1zIHtcbiAgICBjb25zdCBjcmVhdGVEb2N1bWVudE9iamVjdDogQnVsa0luZGV4RG9jdW1lbnRzUGFyYW1zID0ge1xuICAgICAgaW5kZXgsXG4gICAgICBib2R5OiBkb2NcbiAgICAgICAgLm1hcChcbiAgICAgICAgICBpdGVtID0+XG4gICAgICAgICAgICBge1wiaW5kZXhcIjogeyBcIl9pbmRleFwiOiBcIiR7aW5kZXh9XCIgfX1cXG4ke0pTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgLi4udGhpcy5idWlsZERhdGEoaXRlbSwgbWFwcGluZyksXG4gICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoRGF0ZS5ub3coKSkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIH0pfVxcbmAsXG4gICAgICAgIClcbiAgICAgICAgLmpvaW4oJycpLFxuICAgIH07XG4gICAgdGhpcy5jb250ZXh0LndhenVoLmxvZ2dlci5kZWJ1ZyhcbiAgICAgIGBEb2N1bWVudCBvYmplY3Q6ICR7SlNPTi5zdHJpbmdpZnkoY3JlYXRlRG9jdW1lbnRPYmplY3QpfWAsXG4gICAgKTtcbiAgICByZXR1cm4gY3JlYXRlRG9jdW1lbnRPYmplY3Q7XG4gIH1cblxuICBidWlsZERhdGEoaXRlbSwgbWFwcGluZykge1xuICAgIGNvbnN0IGdldEl0ZW1BcnJheSA9IChhcnJheSwgaW5kZXgpID0+IHtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcnJheVtpbmRleCB8fCAwXSk7XG4gICAgfTtcbiAgICBjb25zdCBnZXRWYWx1ZSA9IChrZXk6IHN0cmluZywgaXRlbSkgPT4ge1xuICAgICAgY29uc3Qga2V5cyA9IGtleS5zcGxpdCgnLicpO1xuICAgICAgaWYgKGtleXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGlmIChrZXkubWF0Y2goL1xcWy4qXFxdLykpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0SXRlbUFycmF5KFxuICAgICAgICAgICAgaXRlbVtrZXkucmVwbGFjZSgvXFxbLipcXF0vLCAnJyldLFxuICAgICAgICAgICAga2V5Lm1hdGNoKC9cXFsoLiopXFxdLylbMV0sXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoaXRlbVtrZXldKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBnZXRWYWx1ZShrZXlzLnNsaWNlKDEpLmpvaW4oJy4nKSwgaXRlbVtrZXlzWzBdXSk7XG4gICAgfTtcbiAgICBpZiAobWFwcGluZykge1xuICAgICAgbGV0IGRhdGE7XG4gICAgICBkYXRhID0gbWFwcGluZy5yZXBsYWNlKC9cXCR7KFthLXp8QS1afDAtOXxcXC5cXC1cXF9cXFsuKlxcXV0rKX0vZ2ksICguLi5rZXkpID0+XG4gICAgICAgIGdldFZhbHVlKGtleVsxXSwgaXRlbSksXG4gICAgICApO1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZGF0YSk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBpdGVtLmRhdGEgPT09ICdvYmplY3QnKSB7XG4gICAgICByZXR1cm4gaXRlbS5kYXRhO1xuICAgIH1cbiAgICByZXR1cm4geyBkYXRhOiBpdGVtLmRhdGEgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgYWRkSW5kZXhQcmVmaXgoaW5kZXgpOiBzdHJpbmcge1xuICAgIGNvbnN0IHByZWZpeCA9IGF3YWl0IHRoaXMuY29udGV4dC53YXp1aF9jb3JlLmNvbmZpZ3VyYXRpb24uZ2V0KFxuICAgICAgJ2Nyb24ucHJlZml4JyxcbiAgICApO1xuICAgIHJldHVybiBgJHtwcmVmaXh9LSR7aW5kZXh9YDtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxJQUFBQSxVQUFBLEdBQUFDLE9BQUE7QUFD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